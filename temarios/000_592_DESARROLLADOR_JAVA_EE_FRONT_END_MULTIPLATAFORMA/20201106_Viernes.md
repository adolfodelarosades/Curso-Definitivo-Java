# 20201106 Viernes

### :computer: Ejemplo `04_buscador`

Vamos a realizar una aplicacíon "Mini Google" que busque ciertos temas y muestre enlaces a direcciones Web relacionadas con lo buscado.

![04-01-02-ej](images/04-01-02-ej.png)

La aplicación va a tener un HTML y un Servlet.

`buscador.html`

```html
<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Buscador</title>
</head>
<body>
	<div align="center">
		<h1>Buscador</h1>
		<form action="Buscador" method="post">
			Introduce tema de búsqueda:<input type="text" name="tema"/> 
			<input type="submit" value="Buscar"/>
		</form>
	</div>
</body>
</html>
```

`Item.java`

```java
package model;

public class Item {
   private String titulo;
   private String url;
   private String[] seo;
   private String descripcion;
	
   public Item(String titulo, String url, String[] seo, String descripcion) {
      super();
      this.titulo = titulo;
      this.url = url;
      this.seo = seo;
      this.descripcion = descripcion;
   }
	
   public String getTitulo() {
      return titulo;
   }
   public void setTitulo(String titulo) {
      this.titulo = titulo;
   }
   public String getUrl() {
      return url;
   }
   public void setUrl(String url) {
      this.url = url;
   }
   public String[] getSeo() {
      return seo;
   }
   public void setSeo(String[] seo) {
      this.seo = seo;
   }
   public String getDescripcion() {
      return descripcion;
   }
   public void setDescripcion(String descripcion) {
      this.descripcion = descripcion;
   }
	
}
```

`Buscador.java`

```java
package servlets;

import java.io.IOException;
import java.io.PrintWriter;
import java.util.List;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import model.Item;

/**
 * Servlet implementation class Buscador
 */
@WebServlet("/Buscador")
public class Buscador extends HttpServlet {
	
	private static final long serialVersionUID = 1L;
	
	List<Item> items=List.of(new Item("Casa del libro","http://casadellibro.es", new String[]{"libros","lectura","ocio"},"Libros y más cosas"),
			new Item("La web del gamer","http://gamers.es", new String[]{"juegos","ordenadores","ocio"},"Todo sobre video juegos"),
			new Item("My computer","http://computerall.es", new String[]{"informática","ordenadores"},"Ordenadores al mejor precio"),
			new Item("Fnac","http://fnac.es", new String[]{"juegos","ordenadores","libros"},"Bienvenido al mundo del ocio y la cultura"),
			new Item("Todo pelis","http://filmers.es", new String[]{"cine","peliculas","ocio"},"Entra en el mundo del cine"));		
	
	protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
    String tema=request.getParameter("tema");
    
		response.setContentType("text/html");
		PrintWriter out=response.getWriter();
		out.println("<html><body>");
		
		//recorremos todos los item de la lista
		for(Item item:items) {
			//para cada item, recorremos su array de temas
			//y miramos si alguno coincide con el tema recibido
			for(String dato:item.getSeo()) {
				if(dato.equals(tema)) {
					out.println("<h2><a href='"+item.getUrl()+"'>"+item.getTitulo()+"</a><br/>");
				}
			}
		}
		out.println("</body></html>");	
	}
}
```

Al ejecutar la aplicación tenemos 

![04-02-ej](images/04-02-ej.png)
![04-03-ej](images/04-03-ej.png)
![04-04-ej](images/04-04-ej.png)

Si métemos algún tema que no existe nos devolverá una pantalla en blanco ya veremos más adelante como solucionar esto.

![04-05-ej](images/04-05-ej.png)
![04-06-ej](images/04-06-ej.png)


Existe una forma diferente de hacer la búsqueda usando Streams (debemos cambiar en `buscador.html` el `action="BuscadorStreams"` ):

`BuscadorStreams`

```java
package servlets;

import java.io.IOException;
import java.io.PrintWriter;
import java.util.Arrays;
import java.util.List;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import model.Item;

/**
 * Servlet implementation class Buscador
 */
@WebServlet("/BuscadorStreams")
public class BuscadorStreams extends HttpServlet {
	
	private static final long serialVersionUID = 1L;
	
	List<Item> items=List.of(new Item("Casa del libro","http://casadellibro.es", new String[]{"libros","lectura","ocio"},"Libros y más cosas"),
			new Item("La web del gamer","http://gamers.es", new String[]{"juegos","ordenadores","ocio"},"Todo sobre video juegos"),
			new Item("My computer","http://computerall.es", new String[]{"informática","ordenadores"},"Ordenadores al mejor precio"),
			new Item("Fnac","http://fnac.es", new String[]{"juegos","ordenadores","libros"},"Bienvenido al mundo del ocio y la cultura"),
			new Item("Todo pelis","http://filmers.es", new String[]{"cine","peliculas","ocio"},"Entra en el mundo del cine"));		
			
	protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		
		String tema=request.getParameter("tema");
		
		response.setContentType("text/html");
		PrintWriter out=response.getWriter();
		out.println("<html><body>");
		
		//solución utilizando programación funcional
		items.stream()
			.filter(item->Arrays.stream(item.getSeo())
					.anyMatch(t->t.equals(tema)))
			.forEach(item->out.println("<h2><a href='"+item.getUrl()+"'>"+item.getTitulo()+"</a><br/>"));
		
		out.println("</body></html>");
	}

}
```

## Transferencia de Peticiones

![02-13](images/02-13.png)
![02-19](images/02-19.png)
![02-20](images/02-20.png)
![02-21](images/02-21.png)
![02-22](images/02-22.png)
![02-23](images/02-23.png)
![02-24](images/02-24.png)

## Atributos de Petición

![02-25](images/02-25.png)
![02-26](images/02-26.png)
![02-27](images/02-27.png)

## Atributos de Sesión

![02-28](images/02-28.png)
![02-29](images/02-29.png)
![02-30](images/02-30.png)
![02-31](images/02-31.png)

## Atributos de Aplicación

![02-32](images/02-32.png)
![02-33](images/02-33.png)
![02-34](images/02-34.png)
![02-35](images/02-35.png)

## Cookies

![02-36](images/02-36.png)
![02-37](images/02-37.png)
![02-38](images/02-38.png)
![02-39](images/02-39.png)
![02-40](images/02-40.png)

## Eventos de Aplicación 

![02-41](images/02-41.png)
![02-32](images/02-42.png)
![02-43](images/02-43.png)
![02-44](images/02-44.png)

## Java Server Pages

![03-01](images/03-01.png)
![03-02](images/03-02.png)
![03-03](images/03-03.png)
![03-04](images/03-04.png)

## Componentes de una Página JSP

![03-05](images/03-05.png)
![03-06](images/03-06.png)
![03-07](images/03-07.png)
![03-08](images/03-08.png)

## Directivas JSP

![03-09](images/03-09.png)
![03-10](images/03-10.png)
![03-11](images/03-11.png)
![03-12](images/03-12.png)

## Acciones Implícitas JSP

![03-13](images/03-13.png)
![03-14](images/03-14.png)
![03-15](images/03-15.png)

## Integración Servlets - JSP

![03-16](images/03-16.png)
![03-17](images/03-17.png)

## El Lenguaje de Expresiones EL

![03-18](images/03-18.png)
![03-19](images/03-19.png)
![03-20](images/03-20.png)
![03-21](images/03-21.png)
![03-22](images/03-22.png)
![03-23](images/03-23.png)

## La Librería de Acciones JSTL

![03-24](images/03-24.png)
![03-25](images/03-25.png)
![03-26](images/03-26.png)
![03-27](images/03-27.png)

## Principales Acciones JSTL

![03-28](images/03-28.png)
![03-29](images/03-29.png)
![03-30](images/03-30.png)
![03-31](images/03-31.png)
![03-32](images/03-32.png)
![03-33](images/03-33.png)
![03-34](images/03-34.png)
![03-35](images/03-35.png)
