# 20201123 Lunes.

## :computer `10`<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;**Segundo Ejemplo Relación Muchos A Muchos**

Partiendo del ejemplo `23_formacion_ejb_weblogic_v2` el cual estaba realizado con EJBs y tenia tres entidades `alumnos`, `matriculas` y `cursos` con RELACIÓN UNO A MUCHOS y RELACIÓN MUCHOS A UNO, lo vamos a transformar para que en lugar de usar EJBs use Spring y en lugar de tres entidades solo maneje dos `alumnos` y `cursos` con una RELACIÓN MUCHOS A MUCHOS.

### 01. Mavenizar Proyecto y poner Dependencias

Necesitamos poner las dependencias que se listan a continuación. Con EJBs solo necesitabamos `hibernate-core`, con Spring necesitamos ademas de `hibernate-core` necesitamos `mysql-connector-java` por que no la tenemos en el Tomcat, y las dependencias de Spring `spring-core`, `spring-context`, `spring-web`, `spring-orm`.

`pom.xml`

```html
<!-- https://mvnrepository.com/artifact/mysql/mysql-connector-java -->
	<dependency>
	    <groupId>mysql</groupId>
	    <artifactId>mysql-connector-java</artifactId>
	    <version>8.0.19</version>
	</dependency>
  	<!-- https://mvnrepository.com/artifact/org.springframework/spring-core -->
	<dependency>
	    <groupId>org.springframework</groupId>
	    <artifactId>spring-core</artifactId>
	    <version>5.2.9.RELEASE</version>
	</dependency>
	<!-- https://mvnrepository.com/artifact/org.springframework/spring-context -->
	<dependency>
	    <groupId>org.springframework</groupId>
	    <artifactId>spring-context</artifactId>
	    <version>5.2.9.RELEASE</version>
	</dependency>
	<dependency>
	    <groupId>org.springframework</groupId>
	    <artifactId>spring-web</artifactId>
	    <version>5.2.9.RELEASE</version>
	</dependency> 
  	<dependency>
	    <groupId>org.springframework</groupId>
	    <artifactId>spring-orm</artifactId>
	    <version>5.2.9.RELEASE</version>
	</dependency>
  	<!-- https://mvnrepository.com/artifact/org.hibernate/hibernate-core -->
	<dependency>
	    <groupId>org.hibernate</groupId>
	    <artifactId>hibernate-core</artifactId>
	    <version>5.4.18.Final</version>
	</dependency>
	
  </dependencies>
```

### 02. Generación de Entidades `Alumnos` y `Cursos`

Las tablas que tenemos son las siguientes:

![10-01-s-ej](images/10-01-s-ej.png)

Podemos elimianr las entidades del proyecto anterior y generar las entidades con el asistente. El resultado es el siguiente:

`Alumno`

```java
```

`Curso`

```java
```

### 03. Capa de Servicio

Aquí hemos cambiado los EJBs por Clases Spring con sus respectivas Interfaces.

`AlumnosService`

```java
```

`AlumnosServiceImpl`

```java
```

`CursosService`

```java
```

`CursosServiceImpl`

```java
```

### 04. Configuración de Archivos XMl

`web.xml`

```html
```

`springConfig.xml`
```html
```

### 05. Cambios en los Actions

En los Actions antes inyectabamos los EJBs de la siguiente forma:

```java
@EJB
AlumnosService service;
protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {	
...
```

Al ya no usar EJBs esto lo debemos campiar para inyectar nuestra capa de Servicio realizada con Spring, además debemos sobreescribir el método `init` de los Servlets para informar al servidor de aplicaciones que Spring va a realizar inyección de objetos en este servlet

```java
@Autowired
AlumnosService service;

@Override
public void init(ServletConfig config) throws ServletException {
   //le informa al servidor de aplicaciones que Spring va a realizar inyección
	 //de objetos en este servlet
	 SpringBeanAutowiringSupport.processInjectionBasedOnCurrentContext(this);
   super.init(config);
}

protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
...		
```

Este cambio lo hacemos en todos los Actions que nos marcan error. En el caso del Action `AlumnosNotaAction` este lo vamos a elimanar por que en este ejemplo no estamos usando las notas.

### 06. Cambios en el Controller

Como hemos eliminado el Action `AlumnosNotaAction` eliminamos la opción `doAlumnosNota` y `toNota`.


```java
...
case "doAlumnosNota":
			request.getRequestDispatcher("AlumnosNotaAction").include(request, response);
			url="alumnosnota.jsp";
			break;
...      
case "toNota":
			url="nota.html";
			break;
...
```

### 07. Cambios enlas Vistas.

Eliminamos las vistas `alumnosnota.jsp` y `nota.html` y de `menu.html` eliminamos la opción `Buscar Alumnos Nota`.

### 08. Probar la Aplicación.

``
```java
```

``
```java
```

