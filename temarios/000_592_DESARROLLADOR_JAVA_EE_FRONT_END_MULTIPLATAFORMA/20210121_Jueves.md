# 20210121 Jueves

### :computer: `31_cliente_front_pedidos`
#### FrontEnd de la Aplicación realizada con JS, (ServerLess)

![20210120-69](images2/20210120-69.png)

![20210120-68](images2/20210120-68.png)


`nuevopedido.html`

```html
<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
<title>Insert title here</title>
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">

<!-- jQuery library -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<!-- Latest compiled JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script> 
</head>
<body>
   <div ng-app="comunicacionApp" ng-controller="comunicacionController" class="container" ng-init="cargarProductos()">
      <h1>Pedidos</h1>
      <div class="row">	
         <div class="col-sm-6" style="border:solid 1px">
            <br/>
			
            <div class="form-group">
               <label>Producto</label>
               <select  ng-model="producto" class="form-control" style="width:80%">
                  <option ng-repeat="v in productos" value="{{v.codigoProducto}}">{{v.producto}} - {{v.precioUnitario}} - {{v.stock}}</option>	
               </select>
            </div>
		
            <div class="form-group">
               <label>Unidades</label>
               <input type="number" min="0" ng-model="unidades" class="form-control" style="width:80%"/>
            </div>
		
            <br/>
            <br/>
         </div>
         <div class="col-sm-6" style="border:solid 1px">
            <div ng-show="mostrarTabla" >
               <h3>Datos del pedido</h3>
               <hr>
               <h4>Producto: {{producto}}</h4>
               <h4>Unidades: {{unidades}}</h4>
            </div>
         </div>
      </div>
      <br/>
		
      <button ng-click="pedido()" type="button">Confirmar Pedido</button>
      <br/><br/><br/>
      <a href="pedidos.html">Ver Pedidos</a>
	
   </div>
   <script>
      var app=angular.module("comunicacionApp",[]);
      app.controller("comunicacionController",function($scope,$http){
         $scope.productos; //aquí se guardarán los productos obtenidos en la petición al servicio de productos
         $scope.producto; //aquí se guarda el código de producto seleccionado en la lista			
         $scope.unidades; //aquí se guarda las unidades introducidas en el campo unidades		
         $scope.mostrarTabla=true;			
			
         $scope.cargarProductos=function(){				
            let url = "http://localhost:9000/productos";	
            $http.get(url).then(function(res){
               $scope.productos=res.data;								
            });
         }
         $scope.pedido=function(){
            let url="http://localhost:8000/pedido";
            /*let ob=new Object();
            ob.codigoProducto=$scope.producto;
            ob.unidades=$scope.unidades;
            $http.post(url,ob);*/
            $http.post(url,{"codigoProducto":$scope.producto, "unidades":$scope.unidades});
            //.then(function(res){
            //	console.log(res.data);								
            //});
			
         };
      });	
   </script>
</body>
</html>
```
* Parte HTML
   * Cliente desarrollado con AngularJS.
   * Div principal con el nombre de la aplicación y el controler e invocamos a la función `cargarProductos()` para cargar todos los productos.
   * En el Select que muestra la lista de los Productos, recorremos lo todos los `productos` que ya se ha cargado gracias a invocar la función `cargarProductos()` y por cada uno de ellos mostramos una opción del Select.
   * Damos el nombre a la opción seleccionada con una propiedad de ambito con `ng-model="producto"` y almacenamos el value del option seleccinado, es decir `value="{{v.codigoProducto}}"` que estamos almacenando el código del producto en la propiedad de ambito `producto`
   * En el input de abajo vamos a almacenar otra propiedad de ambiente `unidades`
   * Con estas dos propiedad de ambiente ya podemos llamar a nuestra función `pedido()` que nos va a permitir invor al Alta de Pedidos, al pusar el botón.

* Parte JS
   * Tenemos la función `cargarProductos` la cual es la encargada de lanzar una petición GET a la URL `"http://localhost:9000/productos"`, los valores recuperados los guardamos en la propiedad de ambiente `productos`
    * Tenemos la función `pedido` la cual es la encargada de lanzar una petición POST a la URL `"http://localhost:8000/pedido"` con el documento JSON con los datos a enviar, el método `$http.post(` necesita como parámetros la URL y el JSON que va se va a mandar.
       * Podemos colocar directamente es JSON o crear un Objeto con los datos y mandar ese objeto, AngularJS se encarga de SERIALIZAR el Objeto a JSON.
    * Las URLs que pongamos en JS deben ser las URLs reales es decir `"http://localhost:9000/productos"` y `"http://localhost:8000/pedido"`.
   * Con JS no puedo usar las direcciones Eureka `"http://servicio-productos"` y `"http://servicio-pedidos"` esto es por que JS no es un Cliente Eureka como si que lo son los MicroServicios, JS no tiene acceso a Eureka, por eso es necesario usar las URLs reales.
   * La solución a este problema es usar Zuul.

`pedidos.html`

```html
<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
<title>Insert title here</title>
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">

<!-- jQuery library -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<!-- Latest compiled JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script> 
</head>
<body>
   <div ng-app="comunicacionApp" ng-controller="comunicacionController" class="container">
      <h1>Pedidos</h1>
      <br/>
      <div >
         <table border="1" class="table table-striped table-bordered" ng-init="cargar()">
            <thead><tr><th>Numero de pedido</th><th>Producto</th><th>Total</th><th>Fecha pedido</th></tr></thead>
            <tbody>
               <tr ng-repeat="r in pedidos">
                  <td>{{r.idPedido}}</td>
                  <td>{{r.codigoProducto}}</td>
                  <td>{{r.total}}</td>
                  <td>{{r.fechaPedido}}</td>
               </tr>
            </tbody>
         </table>
      </div>
      <br/>
      <a href="nuevopedido.html">Nuevo pedido</a>
   </div>
   <script>
      var app=angular.module("comunicacionApp",[]);
      app.controller("comunicacionController",function($scope,$http){
         $scope.pedidos;	
         $scope.cargar=function(){				
            let url="http://localhost:8000/pedidos";		
            $http.get(url).then(function(res){
               $scope.pedidos=res.data;			
            });
         }		
      });
   </script>
</body>
</html>
```
* Contamos con la función `cargar` que invoca al servicio `http://localhost:8000/pedidos` con el método GET para que nos retorne la lista de los pedidos y los podamos pintar en la página.


#### Probar la Aplicación

![20210120-70](images2/20210120-70.png)
![20210120-71](images2/20210120-71.png)
![20210120-72](images2/20210120-72.png)
![20210120-73](images2/20210120-73.png)
![20210120-74](images2/20210120-74.png)
![20210120-75](images2/20210120-75.png)
![20210120-76](images2/20210120-76.png)

## Servidor Zuul

![20210120-13](images/20210120-13.png)
![20210120-14](images/20210120-14.png)
![20210120-15](images/20210120-15.png)
![20210120-16](images/20210120-16.png)
![20210120-17](images/20210120-17.png)

``
```java
```


``
```java
```

``
```java
```


